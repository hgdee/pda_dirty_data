---
title: "D12 Dirty Data Project"
output:
  html_document: 
    number_sections: yes
    toc: yes
    df_print: paged
    toc_float: yes
---

```{r}
library(tidyverse)
library(here)
library(janitor)
library(stringr)
library(assertr)
library(testthat)
library(readxl)
```

1 MVP
1.1 Task 1 - Decathlon Data
This data is contained in the .rds file decathlon.rds. You’ll need to use read_rds() from readr to open it.

# Call R file to process the rds file.

```{r}
source(here::here("R_scripts/read_rds_data.R"))
```

```{r}
decathlon_data  
```


# 1.1.2 Analysis questions
  ## 1 Who had the longest long jump seen in the data?
```{r}
decathlon_data %>% 
  filter(long_jump == max(long_jump))
```

  ## 2 What was the average 100m time in each competition?
```{r}
decathlon_data %>% 
  group_by(competition) %>%
   summarise(mean(x100m))
```
  
## 3 Who had the highest total points across both competitions?
```{r}
decathlon_data %>% 
  filter(points== max(points))
```
  ## 4 What was the shot-put scores for the top three competitors in each competition?
```{r}
rbind(decathlon_data %>% 
  filter(competition == "olympicg") %>%
  select(competition,competitor,shot_put) %>%
  group_by(competition, competitor) %>%
  arrange(desc(shot_put)) %>%
  head(3), 
  decathlon_data %>% 
  filter(competition == "decastar") %>%
  select(competition,competitor,shot_put) %>%
  group_by(competition, competitor) %>%
  arrange(desc(shot_put)) %>%
  head(3))



```
  
## 5 What was the average points for competitors who ran the 400m in less than 50 seconds vs. those than ran 400m in more than 50 seconds?

```{r}
rbind(decathlon_data  %>%
    filter(x400m < 50) %>%
    summarise(round(mean(points),2 )) %>%
    distinct() %>%
    paste( " average points where 400m < 50 secs"),
  decathlon_data  %>%
    filter(x400m >= 50) %>%
    summarise( round(mean(points),2)) %>%
    distinct() %>%
    paste( " average points where 400m >= 50 secs")
)

```

# 1.4 Task 4 - Halloween Candy Data
The data is in files boing-boing-candy-2015.xlxs, boing-boing-candy-2016.xlxs and boing-boing-candy-2017.xlxs. Bear in mind that this is trickier compared with tasks 1, 2 & 3.

```{r}

source(here::here("R_scripts/read_in_candy_data.R"))


```

## Output to show valid which_country_do_you_live_in data
    2015 was populated using 2016 residence data and looping to populate
    the larger data set.


# Now the three years of data need to be merged. 

```{r}

source(here::here("R_scripts/drop_cols_and_merge.R"))

```

```{r}
glimpse(candy_data)

```

# 1.4.2 Analysis questions

## 1. What is the total number of candy ratings given across the three years. (number of candy ratings, not number of raters. Don’t count missing values)

```{r}
candy_data  %>%
    pivot_longer(cols=5:80, values_drop_na = TRUE) %>%
    count(value) %>%
    arrange(desc(n))
  
  
```
## 2. What was the average age of people who are going out trick or treating and the average age of people not going trick or treating?

```{r}


candy_data %>%
  select(are_you_going_actually_going_trick_or_treating_yourself, 
          how_old_are_you) %>%
  drop_na() %>%
  group_by(are_you_going_actually_going_trick_or_treating_yourself) %>%
  summarise(mean = round(mean(how_old_are_you)))

  # as many ages are implausible restrict the age to 5-100
candy_data %>%
  select(are_you_going_actually_going_trick_or_treating_yourself, 
          how_old_are_you) %>%
  filter(how_old_are_you >= 5 & how_old_are_you <= 100) %>%
  drop_na() %>%
  group_by(are_you_going_actually_going_trick_or_treating_yourself) %>%
  summarise(mean = round(mean(how_old_are_you)))
```

## 3. For each of joy, despair and meh, which candy bar received the most of these ratings?

```{r}

pivot_candy <- candy_data  %>%
    pivot_longer(cols=5:80,   names_to = "candy_bar_name", 
                              values_to = "customer_satisfaction",
                              values_drop_na = TRUE)

pivot_candy %>% 
      group_by(candy_bar_name)  %>%
      filter(customer_satisfaction == "DESPAIR") %>%
      select(candy_bar_name,customer_satisfaction)  %>%
      count() %>%
      arrange(desc(n)) %>%
      head(1)

pivot_candy %>% 
      group_by(candy_bar_name)  %>%
      filter(customer_satisfaction == "MEH") %>%
      select(candy_bar_name, customer_satisfaction)  %>%
      count() %>%
      arrange(desc(n)) %>%
      head(1)

# Not sure "any_full_sized_candy_bar" counts so headed 2
pivot_candy %>% 
      group_by(candy_bar_name)  %>%
      filter(customer_satisfaction == "JOY") %>%
      select(candy_bar_name, customer_satisfaction)  %>%
      count() %>%
      arrange(desc(n)) %>%
      head(2)
```



## 4 How many people rated Starburst as despair?

```{r}
pivot_candy %>% 
      group_by(candy_bar_name)  %>%
      filter(toupper( candy_bar_name) == "STARBURST" & 
                      customer_satisfaction == "DESPAIR") %>%
      select(candy_bar_name, customer_satisfaction) %>%
      count() 
```

# For the next three questions, count despair as -1, joy as +1 and meh as 0.

## 6 (?) What was the most popular candy bar by this rating system for each gender in the dataset?

```{r}
pivot_candy[pivot_candy == "JOY"] <-     "1"
pivot_candy[pivot_candy == "MEH"] <-     "0"
pivot_candy[pivot_candy == "DESPAIR"] <- "-1"
pivot_candy$customer_satisfaction  <- as.integer(pivot_candy$customer_satisfaction)
# As 'other' and 'I'd rather not say' look to be the same then combine
pivot_candy[pivot_candy == "I'd rather not say"] <-     "Other"
```


```{r}

# num of gender type
gender_num <- pivot_candy %>% 
              filter(!is.na(your_gender))  %>%
              distinct(your_gender) %>%
              count()

pivot_candy %>% 
      select(candy_bar_name, your_gender, customer_satisfaction)  %>%
      filter(!is.na(your_gender))   %>%
      group_by(your_gender, candy_bar_name)  %>%
      mutate( customer_satisfaction_total = sum(customer_satisfaction)) %>%
      summarise(unique(your_gender),
                unique(candy_bar_name),
                customer_satisfaction_total) %>%
      arrange(  desc(customer_satisfaction_total),
                your_gender,
                candy_bar_name)




```


